# 어플리케이션 개발하기 - View 및 Template 코딩

- 앞서 polls 어플리케이션을 설계할 때 3개의 페이지가 필요

- 위 3개의 페이지를 보여주기 위해 필요한 뷰와 템플릿을 코딩

- 개발자의 설계에 따라 달라지겠지만, 여기에서는 4개의 URL과 View가 필요하다고 판단, 다음과 같이 설계:

  | URL              | View      | Template    | NOTE                                  |
  | ---------------- | --------- | ----------- | ------------------------------------- |
  | /polls/          | index()   | index.html  | index.html 템플릿을 보여줌            |
  | /polls/#/        | detail()  | detail.html | detail.html 템플릿을 보여줌           |
  | /polls/#/vote/   | vote()    |             | detail.html의 폼을 POST 방식으로 처리 |
  | /polls/#/results | results() | result.html | result.html 템플릿을 보여줌           |

  #은 질문번호가 채워지는 자리

- 이러한 과정을 URL/뷰 매핑, URLconf라고 하며, urls.py파일에 작성
- 본 챕터는 아래 순서대로 코딩 진행 (URLconf > 뷰/템플릿)

```
url.py 작성                       // URLconf 내용을 코딩
views.index() 함수 작성           // index.html 템플릿도 같이 작성
views.detail() 함수 작성          // detail.html 템플릿도 같이 작성
views.vote() 함수 작성            // 리다이렉션 처리
views.results() 함수 작성         // results.html 템플릿도 같이 작성
```

___

## 1. URLconf 코딩

- URLconf 설계 내용에 따르면, Admin 사이트까지 포함, 5개의 URL과 뷰가 필요

- 위 내용은 그대로 `url.py` 파일에 코딩

  ```python
  from django.contrib import admin
  from django.urls import path
  from polls import views
  
  urlpatterns = [
      path('admin/', admin.site.urls),
      path('polls/', views.index, name = 'index'),
      path('polls/<int:question_id>', views.detail, name='detail'),
      path('polls/<int:question_id>/results', views.results, name='results'),
      path('polls/<int:question_id>/vote/', views.vote, name='vote')
  ]
  ```

  > - admin 모듈과 path() 함수는 Django에서 제공, views 모델은 하단에서 코딩 예정
  > - URL 패턴 매칭은 위에서 아래로 진행하므로 순서에 유의

- `django.urls`의 `path()` 함수는 route, view 2개의 필수 인자와, kwargs, name 2개의 선택 인자를 입력

  1. **route**: URL 패턴을 표현하는 문자열 혹은 URL 스트링
  2. **view**: URL 스트링이 매칭되면 호출되는 뷰 함수로 HttpRequest 객체와 URL 스트링에서 추출된 항목을 인자로 사용
  3. **name**: 각 URL 패턴별로 이름을 붙여서 사용 (템플렛 파일에서 사용)

- 위 코딩을 살펴 보았을 때, 요청의 URL이 **/admin/**이라면 아래 라인이 매칭:

  ```python
  path('admin/', admin.site.urls)
  ```

  > - 장고에서 제공해주는 admin 앱의 URL 매핑 처리에 일임하여, 장고의 Admin 사이트를 그대로 사용

- 요청의 URL이 **/polls/**라면, 아래 라인이 매칭:

  ```python
  path('polls/', views.index, name = 'index')
  ```

  > - URL 스트링에서 추출되는 항목이 없으므로 `views.index(request)` 처럼 뷰함수가 호출
  > - 위 URL 패턴의 이름은 'index'로 정의

- 요청의 URL이 **/polls/3/**이라면 아래 라인이 매칭:

  ```python
  path('polls/<int:question_id>', views.detail, name='detail')
  ```

  > - URL 스트링에서 '3'이 추출되므로 뷰 함수 호출 시  `views.detail(request, question_id=3)`처럼 인자가 대입
  > - URL 패턴의 이름은 'detail'로 정의

- `results`와 `vote`에 대해서는 `detail`과 유사한 방식으로 URL 패턴 정의

- 추가적으로 `mysite/settings.py` 파일에 `ROOT_URLCONF` 항목이 정의되며, URL 분석 시 위 항목에 정의된 url.py 파일을 가장 먼저 분석

  ```
  ROOT_URLCONF = 'mysite.urls'
  ```

- 한가지 더 알아두어야 할 사항은 URLconf를 코딩할 때, 위에처럼 하나의 `urls.py`파일에 작성할 수도 있고, 아래와 같이 `mysite/urls.py`와 `polls/urls.py` 2개의 파일에 작성할 수도 있음

  ```python
  ### mysite/urls.py
  
  from django.contrib import admin
  from django.urls import path, include
  
  urlpatterns = [
      path('admin/', admin.site.urls),
      path('polls/', include('polls.urls'))
  ]
  ```

  ```python
  ### polls/urls.py
  
  from django.urls import path
  from . import views
  
  app_name='polls'
  urlpatterns = [
      path('', views.index, name = 'index'),
      path('<int:question_id>', views.detail, name='detail'),
      path('<int:question_id>/results', views.results, name='results'),
      path('<int:question_id>/vote/', views.vote, name='vote')
  ]
  ```

- 당연히 

___

## 2. 뷰 함수 index() 및 템플릿 작성



___

## 3. 뷰 함수 detail() 및 폼 템플릿 작성



___

## 4. 뷰 함수 vote() 및 리다이렉션 작성



___

## 5. 뷰 함수 results() 및 템플릿 작성



___

## 6. 작업 확인하기





